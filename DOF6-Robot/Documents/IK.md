好的，根据你提供的标准 DH 参数表，我们首先定义符号变量来代替具体的数字，以便公式更通用。

### 1. 符号定义与简写说明

**简写约定：**
*   $s_i = \sin(\theta_i)$
*   $c_i = \cos(\theta_i)$

**非零参数符号映射（将具体数值替换为代数符号）：**
*   **Link 1:** $d_1 = 0.1245$, $a_1 = 0.035$, $\alpha_1 = -90^\circ$
*   **Link 2:** $d_2 = 0$, $a_2 = 0.146$, $\alpha_2 = 0^\circ$
*   **Link 3:** $d_3 = 0$, $a_3 = 0.052$, $\alpha_3 = -90^\circ$
*   **Link 4:** $d_4 = 0.117$, $a_4 = 0$, $\alpha_4 = 90^\circ$
*   **Link 5:** $d_5 = 0$, $a_5 = 0$, $\alpha_5 = -90^\circ$
*   **Link 6:** $d_6 = 0.0775$, $a_6 = 0$, $\alpha_6 = 0^\circ$

**标准 DH 变换矩阵通式：**
$$
{}^{i-1}T_i = \begin{bmatrix}
c\theta_i & -s\theta_i c\alpha_i & s\theta_i s\alpha_i & a_i c\theta_i \\
s\theta_i & c\theta_i c\alpha_i & -c\theta_i s\alpha_i & a_i s\theta_i \\
0 & s\alpha_i & c\alpha_i & d_i \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

### 2. 各关节变换矩阵推导

#### **关节 1** (${}^{0}T_{1}$)
参数：$\alpha_1 = -90^\circ$ ($c\alpha_1=0, s\alpha_1=-1$), $d=d_1, a=a_1$
$$
{}^{0}T_{1} = \begin{bmatrix}
c_1 & 0 & -s_1 & a_1 c_1 \\
s_1 & 0 & c_1 & a_1 s_1 \\
0 & -1 & 0 & d_1 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

#### **关节 2** (${}^{1}T_{2}$)
参数：$\alpha_2 = 0^\circ$ ($c\alpha_2=1, s\alpha_2=0$), $d=0, a=a_2$
$$
{}^{1}T_{2} = \begin{bmatrix}
c_2 & -s_2 & 0 & a_2 c_2 \\
s_2 & c_2 & 0 & a_2 s_2 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

#### **关节 3** (${}^{2}T_{3}$)
参数：$\alpha_3 = -90^\circ$ ($c\alpha_3=0, s\alpha_3=-1$), $d=0, a=a_3$
$$
{}^{2}T_{3} = \begin{bmatrix}
c_3 & 0 & -s_3 & a_3 c_3 \\
s_3 & 0 & c_3 & a_3 s_3 \\
0 & -1 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

#### **关节 4** (${}^{3}T_{4}$)
参数：$\alpha_4 = 90^\circ$ ($c\alpha_4=0, s\alpha_4=1$), $d=d_4, a=0$
$$
{}^{3}T_{4} = \begin{bmatrix}
c_4 & 0 & s_4 & 0 \\
s_4 & 0 & -c_4 & 0 \\
0 & 1 & 0 & d_4 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

#### **关节 5** (${}^{4}T_{5}$)
参数：$\alpha_5 = -90^\circ$ ($c\alpha_5=0, s\alpha_5=-1$), $d=0, a=0$
$$
{}^{4}T_{5} = \begin{bmatrix}
c_5 & 0 & -s_5 & 0 \\
s_5 & 0 & c_5 & 0 \\
0 & -1 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

#### **关节 6** (${}^{5}T_{6}$)
参数：$\alpha_6 = 0^\circ$ ($c\alpha_6=1, s\alpha_6=0$), $d=d_6, a=0$
$$
{}^{5}T_{6} = \begin{bmatrix}
c_6 & -s_6 & 0 & 0 \\
s_6 & c_6 & 0 & 0 \\
0 & 0 & 1 & d_6 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

### 3. 使用建议

这些矩阵是建立正运动学模型的基础。如果你需要手动计算末端位置，你需要将它们依次相乘：

$$ {}^{0}T_{6} = {}^{0}T_{1} \cdot {}^{1}T_{2} \cdot {}^{2}T_{3} \cdot {}^{3}T_{4} \cdot {}^{4}T_{5} \cdot {}^{5}T_{6} $$

由于矩阵乘法非常繁琐，通常建议：
1.  **前三个矩阵相乘 (${}^{0}T_{3}$)**：决定了手腕中心的位置（对于满足球形手腕结构的机械臂）。
2.  **后三个矩阵相乘 (${}^{3}T_{6}$)**：决定了末端的姿态。
3.  在 MATLAB 中，直接使用我在上一个回答中提供的 `for` 循环数值解法，或者使用 Symbolic Math Toolbox 进行符号推导（`syms theta1 theta2 ...`）。

这是一份基于你所提供的 Standard DH 参数推导出的矩阵表达式。

为了简化书写，采用以下符号约定：
*   $s_i = \sin(\theta_i)$, $c_i = \cos(\theta_i)$
*   $s_{23} = \sin(\theta_2 + \theta_3)$, $c_{23} = \cos(\theta_2 + \theta_3)$

---

### 1. 关节1变换矩阵的逆矩阵 $(^0T_1)^{-1}$

该矩阵表示将 **基座坐标系 (Frame 0)** 下的点或向量变换到 **关节1坐标系 (Frame 1)** 下。

根据齐次变换矩阵求逆公式 $T^{-1} = \begin{bmatrix} R^T & -R^T p \\ 0 & 1 \end{bmatrix}$，带入 $^0T_1$ 参数（$\alpha_1 = -90^\circ$）：

$$
{}^0T_1 = \begin{bmatrix} c_1 & 0 & -s_1 & a_1 c_1 \\ s_1 & 0 & c_1 & a_1 s_1 \\ 0 & -1 & 0 & d_1 \\ 0 & 0 & 0 & 1 \end{bmatrix}
$$

**求逆结果：**
$$
({}^0T_1)^{-1} = {}^1T_0 = \begin{bmatrix}
c_1 & s_1 & 0 & -a_1 \\
0 & 0 & -1 & d_1 \\
-s_1 & c_1 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

### 2. 关节6变换矩阵的逆矩阵 $(^5T_6)^{-1}$

该矩阵通常用于逆运动学推导中，将末端位姿“回退”到手腕中心。
带入 $^5T_6$ 参数（$\alpha_6 = 0^\circ$）：

$$
{}^5T_6 = \begin{bmatrix} c_6 & -s_6 & 0 & 0 \\ s_6 & c_6 & 0 & 0 \\ 0 & 0 & 1 & d_6 \\ 0 & 0 & 0 & 1 \end{bmatrix}
$$

**求逆结果：**
$$
({}^5T_6)^{-1} = {}^6T_5 = \begin{bmatrix}
c_6 & s_6 & 0 & 0 \\
-s_6 & c_6 & 0 & 0 \\
0 & 0 & 1 & -d_6 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

### 3. 复合变换矩阵 $^1T_5$

该矩阵表示从 **关节1 (肩部)** 到 **关节5 (手腕俯仰)** 的变换。在求解析解（Pieper准则）时非常关键，它包含了 $\theta_2, \theta_3, \theta_4, \theta_5$。

计算路径：$^1T_5 = {}^1T_2 \cdot {}^2T_3 \cdot {}^3T_4 \cdot {}^4T_5$

**结果矩阵表达式：**

$$
{}^1T_5 = \begin{bmatrix}
r_{11} & r_{12} & r_{13} & p_x \\
r_{21} & r_{22} & r_{23} & p_y \\
r_{31} & r_{32} & r_{33} & p_z \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

$$
{}^1T_5 = \begin{bmatrix}
c_{23}c_4c_5 - s_{23}s_5 & -c_{23}s_4 & -c_{23}c_4s_5 - s_{23}c_5 & a_2 c_2 + a_3 c_{23} - d_4 s_{23} \\
s_{23}c_4c_5 + c_{23}s_5 & -s_{23}s_4 & -s_{23}c_4s_5 + c_{23}c_5 & a_2 s_2 + a_3 s_{23} + d_4 c_{23} \\
-s_4c_5 & -c_4 & s_4s_5 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$


**矩阵内部元素详解：**

*   **第一行 (X轴分量):**
    *   $r_{11} = c_{23}c_4c_5 - s_{23}s_5$
    *   $r_{12} = -c_{23}s_4$
    *   $r_{13} = -c_{23}c_4s_5 - s_{23}c_5$
    *   $p_x = a_2 c_2 + a_3 c_{23} - d_4 s_{23}$

*   **第二行 (Y轴分量):**
    *   $r_{21} = s_{23}c_4c_5 + c_{23}s_5$
    *   $r_{22} = -s_{23}s_4$
    *   $r_{23} = -s_{23}c_4s_5 + c_{23}c_5$
    *   $p_y = a_2 s_2 + a_3 s_{23} + d_4 c_{23}$

*   **第三行 (Z轴分量):**
    *   $r_{31} = -s_4c_5$
    *   $r_{32} = -c_4$
    *   $r_{33} = s_4s_5$
    *   $p_z = 0$

**注意：**
1.  **$p_z = 0$ 的含义**：这表明在关节1的坐标系下，机械臂的连杆2、3、4的几何中心始终处于 $X_1-Y_1$ 平面上（这是大多数工业机械臂的设计特点，即肩、肘、腕的移动在一个平面内，该平面随关节1旋转）。
2.  **符号对应**：
    *   $a_2, a_3$ 对应表中的 $0.146, 0.052$
    *   $d_4$ 对应表中的 $0.117$
    


根据机器人逆运动学求解的常用步骤（Pieper 准则分离手腕），你要求的运算实际上是求 **${}^1T_5$** 的目标矩阵表达式。

该运算的几何含义是将末端位姿 ${}^{0}T_{6}$ 变换到关节 1 的坐标系下，并减去工具法兰（关节 6）的影响，从而得到“肩部到手腕中心”的变换矩阵。

$$
{}^{0}T_{6} = \begin{bmatrix}
n_x & o_x & a_x & p_x \\
n_y & o_y & a_y & p_y \\
n_z & o_z & a_z & p_z \\
0 & 0 & 0 & 1
\end{bmatrix}
$$


---

---


$$\boxed{
({}^{0}T_{1})^{-1} \cdot {}^{0}T_{6}
=
\begin{bmatrix}
c_1 n_x + s_1 n_y & c_1 o_x + s_1 o_y & c_1 a_x + s_1 a_y & c_1 p_x + s_1 p_y - a_1\\
-n_z & -o_z & -a_z & -p_z + d_1\\
-s_1 n_x + c_1 n_y & -s_1 o_x + c_1 o_y & -s_1 a_x + c_1 a_y & -s_1 p_x + c_1 p_y\\
0 & 0 & 0 & 1
\end{bmatrix}
}$$

$${{}^{1}T_{6}=
\begin{bmatrix}
c_{23} c_{4} c_{5} c_{6} - c_{23} s_{4} s_{6} - c_{6} s_{23} s_{5} & -c_{23} c_{4} c_{5} s_{6} - c_{23} c_{6} s_{4} + s_{23} s_{5} s_{6} & -c_{23} c_{4} s_{5} - c_{5} s_{23} & a_2 c_2 + a_3 c_{23} - d_4 s_{23} - d_6(c_{23} c_4 s_5 + c_5 s_{23})\\
c_{4} c_{5} c_{6} s_{23} - s_{23} s_{4} s_{6} + c_{23} c_{6} s_{5} & -c_{4} c_{5} s_{23} s_{6} - c_{6} s_{23} s_{4} - c_{23} s_{5} s_{6} & -c_{4} s_{23} s_{5} + c_{23} c_{5} & a_2 s_2 + a_3 s_{23} + d_4 c_{23} + d_6(-c_4 s_{23} s_5 + c_{23} c_5)\\
-c_{6} s_{4} c_{5} - c_{4} s_{6} & s_{4} c_{5} s_{6} - c_{4} c_{6} & s_{4} s_{5} & d_4 + d_6 s_4 s_5\\
0 & 0 & 0 & 1
\end{bmatrix}}$$



---

---



$${
\mathbf{M}_{15} = 
\begin{bmatrix}
c_1(c_6 n_x - s_6 o_x) + s_1(c_6 n_y - s_6 o_y) & c_1(s_6 n_x + c_6 o_x) + s_1(s_6 n_y + c_6 o_y) & c_1 a_x + s_1 a_y & c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1\\
-c_6 n_z + s_6 o_z & -s_6 n_z - c_6 o_z & -a_z & -p_z + d_6 a_z + d_1\\
-s_1(c_6 n_x - s_6 o_x) + c_1(c_6 n_y - s_6 o_y) & -s_1(s_6 n_x + c_6 o_x) + c_1(s_6 n_y + c_6 o_y) & -s_1 a_x + c_1 a_y & -s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)\\
0 & 0 & 0 & 1
\end{bmatrix}
}$$

$$\boxed{{}^{1}T_{5}=
\begin{bmatrix}
c_5c_{23}c_4-s_5s_{23} & -c_{23}s_4 & -c_5s_{23}-c_{23}c_4s_5 & a_{2}c_{2}+a_{3}c_{23}-d_4 s_{23}\\
c_5s_{23}c_4+c_{23}s_5 & -s_{23}s_4 & c_5c_{23}-s_{23}c_4s_5 & a_{2}s_{2}+a_{3}s_{23}+d_4 c_{23}\\
-c_5s_4 & -c_4 & s_4s_5 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$



---

---



$$
\mathbf{M}_{14} = 
\begin{bmatrix}
c_1[c_5(c_6 n_x - s_6 o_x) - s_5 a_x] + s_1[c_5(c_6 n_y - s_6 o_y) - s_5 a_y] & c_1[s_5(c_6 n_x - s_6 o_x) + c_5 a_x] + s_1[s_5(c_6 n_y - s_6 o_y) + c_5 a_y] & -c_1(s_6 n_x + c_6 o_x) - s_1(s_6 n_y + c_6 o_y) & c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1\\
-c_5(c_6 n_z - s_6 o_z) + s_5 a_z & -s_5(c_6 n_z - s_6 o_z) - c_5 a_z & s_6 n_z + c_6 o_z & -p_z + d_6 a_z + d_1\\
-s_1[c_5(c_6 n_x - s_6 o_x) - s_5 a_x] + c_1[c_5(c_6 n_y - s_6 o_y) - s_5 a_y] & -s_1[s_5(c_6 n_x - s_6 o_x) + c_5 a_x] + c_1[s_5(c_6 n_y - s_6 o_y) + c_5 a_y] & s_1(s_6 n_x + c_6 o_x) - c_1(s_6 n_y + c_6 o_y) & -s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)\\
0 & 0 & 0 & 1
\end{bmatrix}
$$

$$\boxed{{}^{1}T_{4}=
\begin{bmatrix}
c_{23}c_4 & -s_{23} & c_{23}s_4 & a_{2}c_{2}+a_{3}c_{23}-d_4 s_{23}\\
s_{23}c_4 & c_{23} & s_{23}s_4 & a_{2}s_{2}+a_{3}s_{23}+d_4 c_{23}\\
-s_4 & 0 & c_4 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$


---

---

$$\boxed{
{}^{2}T_{6}=
\begin{bmatrix}
c_6(c_3 c_4 c_5 - s_3 s_5) - c_3 s_4 s_6 & -s_6(c_3 c_4 c_5 - s_3 s_5) - c_3 c_6 s_4 & -c_3 c_4 s_5 - s_3 c_5 & a_3 c_3 - d_4 s_3 - d_6(c_3 c_4 s_5 + s_3 c_5)\\
c_6(c_3 s_5 + c_4 c_5 s_3) - s_3 s_4 s_6 & -s_6(c_3 s_5 + c_4 c_5 s_3) - c_6 s_3 s_4 & c_3 c_5 - c_4 s_3 s_5 & a_3 s_3 + d_4 c_3 + d_6(c_3 c_5 - c_4 s_3 s_5)\\
-c_4 s_6 - c_5 c_6 s_4 & -c_4 c_6 + c_5 s_4 s_6 & s_4 s_5 & d_6 s_4 s_5\\
0 & 0 & 0 & 1
\end{bmatrix}
}$$
---

---


$$
{}^4T_6 = \begin{bmatrix}
c_5 c_6 & -c_5 s_6 & -s_5 & -d_6 s_5 \\
s_5 c_6 & -s_5 s_6 & c_5 & d_6 c_5 \\
-s_6 & -c_6 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

---



$$
{}^3T_6 = \begin{bmatrix}
c_4 c_5 c_6 - s_4 s_6 & -c_4 c_5 s_6 - s_4 c_6 & -c_4 s_5 & -d_6 c_4 s_5 \\
s_4 c_5 c_6 + c_4 s_6 & -s_4 c_5 s_6 + c_4 c_6 & -s_4 s_5 & -d_6 s_4 s_5 \\
s_5 c_6 & -s_5 s_6 & c_5 & d_6 c_5 + d_4 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

---


$$
{}^2T_5 = \begin{bmatrix}
c_3 c_4 c_5 - s_3 s_5 & -c_3 s_4 & -c_3 c_4 s_5 - s_3 c_5 & a_3 c_3 - d_4 s_3 \\
s_3 c_4 c_5 + c_3 s_5 & -s_3 s_4 & -s_3 c_4 s_5 + c_3 c_5 & a_3 s_3 + d_4 c_3 \\
-s_4 c_5 & -c_4 & s_4 s_5 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
*(注：第4列即位置向量，表示从关节2原点到手腕中心在关节2坐标系下的投影)*

---

---






$$ ({}^{0}T_{1})^{-1} \cdot {}^{0}T_{6} \cdot ({}^{5}T_{6})^{-1} \cdot ({}^{4}T_{5})^{-1} $$


运算公式为：
$$ \text{Result} = ({}^{0}T_{1})^{-1} \cdot {}^{0}T_{6} \cdot ({}^{5}T_{6})^{-1} $$

以下是计算结果，矩阵中的元素用 $n, o, a, p$ 表示：

### 计算结果矩阵

$$
{}^1T_5 =
\begin{bmatrix}
c_6(c_1 n_x + s_1 n_y) - s_6(c_1 o_x + s_1 o_y) & s_6(c_1 n_x + s_1 n_y) + c_6(c_1 o_x + s_1 o_y) & c_1 a_x + s_1 a_y & c_1 p_x + s_1 p_y - a_1 - d_6(c_1 a_x + s_1 a_y) \\
-c_6 n_z + s_6 o_z & -s_6 n_z - c_6 o_z & -a_z & d_1 - p_z + d_6 a_z \\
c_6(-s_1 n_x + c_1 n_y) - s_6(-s_1 o_x + c_1 o_y) & s_6(-s_1 n_x + c_1 n_y) + c_6(-s_1 o_x + c_1 o_y) & -s_1 a_x + c_1 a_y & -s_1 p_x + c_1 p_y - d_6(-s_1 a_x + c_1 a_y) \\
0 & 0 & 0 & 1
\end{bmatrix}
 = \begin{bmatrix}
c_{23}c_4c_5 - s_{23}s_5 & -c_{23}s_4 & -c_{23}c_4s_5 - s_{23}c_5 & a_2 c_2 + a_3 c_{23} - d_4 s_{23} \\
s_{23}c_4c_5 + c_{23}s_5 & -s_{23}s_4 & -s_{23}c_4s_5 + c_{23}c_5 & a_2 s_2 + a_3 s_{23} + d_4 c_{23} \\
-s_4c_5 & -c_4 & s_4s_5 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

### 矩阵元素详细表达式

为了清晰起见，我们将旋转部分 ($R$) 和位置部分 ($P'$) 分开列出。

#### 1. 位置向量 (第4列)
这部分最重要，通常用于求解 $\theta_1$。

*   **$P_x'$ (第1行第4列):**
    $$ c_1 p_x + s_1 p_y - a_1 - d_6(c_1 a_x + s_1 a_y) $$
    *(含义：去除 d6 长度后，在关节 1 坐标系 X 轴上的投影)*

*   **$P_y'$ (第2行第4列):**
    $$ d_1 - p_z + d_6 a_z $$
    *(含义：去除 d6 长度后，在关节 1 坐标系 Y 轴上的投影，注意此处包含 -p_z)*

*   **$P_z'$ (第3行第4列):**
    $$ -s_1 p_x + c_1 p_y - d_6(-s_1 a_x + c_1 a_y) $$
    *(含义：去除 d6 长度后，在关节 1 坐标系 Z 轴上的投影)*

---

#### 2. 旋转矩阵部分 (前3行3列)

*   **第一行:**
    *   $R_{11} = c_6(c_1 n_x + s_1 n_y) - s_6(c_1 o_x + s_1 o_y)$
    *   $R_{12} = s_6(c_1 n_x + s_1 n_y) + c_6(c_1 o_x + s_1 o_y)$
    *   $R_{13} = c_1 a_x + s_1 a_y$

*   **第二行:**
    *   $R_{21} = -c_6 n_z + s_6 o_z$
    *   $R_{22} = -s_6 n_z - c_6 o_z$
    *   $R_{23} = -a_z$

*   **第三行:**
    *   $R_{31} = c_6(-s_1 n_x + c_1 n_y) - s_6(-s_1 o_x + c_1 o_y)$
    *   $R_{32} = s_6(-s_1 n_x + c_1 n_y) + c_6(-s_1 o_x + c_1 o_y)$
    *   $R_{33} = -s_1 a_x + c_1 a_y$

---

### 用途说明

这个矩阵可以直接与上一轮对话中通过 DH 参数推导出的 **${}^1T_5$** 进行元素对应，从而建立方程组求解关节角：

1.  **求解 $\theta_1$**: 观察 **$P_z'$** (第3行第4列)。在上一轮的 DH 推导中，${}^1T_5$ 的 $p_z$ 为 0。
    令上述 $P_z' = 0$，即：
    $$ -s_1 p_x + c_1 p_y - d_6(-s_1 a_x + c_1 a_y) = 0 $$
    整理后可得：
    $$ c_1 (p_y - d_6 a_y) = s_1 (p_x - d_6 a_x) $$
    从而解出 $\theta_1 = \text{atan2}(p_y - d_6 a_y, \ p_x - d_6 a_x)$。

2.  **求解 $\theta_5$**: 利用 $R_{13}, R_{23}, R_{33}$ 与 DH 参数对应项。
3.  **求解 $\theta_6$**: 利用 $R_{21}, R_{22}$ 等项。




$$
\begin{bmatrix}
R_{11} & R_{12} & R_{13} & P_x' \\
R_{21} & R_{22} & R_{23} & P_y' \\
R_{31} & R_{32} & R_{33} & P_z' \\
0 & 0 & 0 & 1
\end{bmatrix}
$$


根据你的要求，这里详细列出从手腕部分开始的各级复合变换矩阵。这些矩阵在逆运动学推导中非常关键，用于将问题分解。

符号约定：
*   $c_i = \cos(\theta_i)$, $s_i = \sin(\theta_i)$
*   $T_{XY}$ 表示 ${}^X T_Y$ (从坐标系 X 到 坐标系 Y 的变换)

---


$$
{}^1T_5 =
\begin{bmatrix}
c_6(c_1 n_x + s_1 n_y) - s_6(c_1 o_x + s_1 o_y) & s_6(c_1 n_x + s_1 n_y) + c_6(c_1 o_x + s_1 o_y) & c_1 a_x + s_1 a_y & c_1 p_x + s_1 p_y - a_1 - d_6(c_1 a_x + s_1 a_y) \\
-c_6 n_z + s_6 o_z & -s_6 n_z - c_6 o_z & -a_z & d_1 - p_z + d_6 a_z \\
c_6(-s_1 n_x + c_1 n_y) - s_6(-s_1 o_x + c_1 o_y) & s_6(-s_1 n_x + c_1 n_y) + c_6(-s_1 o_x + c_1 o_y) & -s_1 a_x + c_1 a_y & -s_1 p_x + c_1 p_y - d_6(-s_1 a_x + c_1 a_y) \\
0 & 0 & 0 & 1
\end{bmatrix}
 = \begin{bmatrix}
c_{23}c_4c_5 - s_{23}s_5 & -c_{23}s_4 & -c_{23}c_4s_5 - s_{23}c_5 & a_2 c_2 + a_3 c_{23} - d_4 s_{23} \\
s_{23}c_4c_5 + c_{23}s_5 & -s_{23}s_4 & -s_{23}c_4s_5 + c_{23}c_5 & a_2 s_2 + a_3 s_{23} + d_4 c_{23} \\
-s_4c_5 & -c_4 & s_4s_5 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

### 1. 矩阵 ${}^4T_6$ (T64)
**物理意义：** 从关节4坐标系到末端法兰中心的变换。
**计算路径：** ${}^4T_5 \cdot {}^5T_6$

$$
{}^4T_6 = \begin{bmatrix}
c_5 c_6 & -c_5 s_6 & -s_5 & -d_6 s_5 \\
s_5 c_6 & -s_5 s_6 & c_5 & d_6 c_5 \\
-s_6 & -c_6 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

### 2. 矩阵 ${}^3T_6$ (T63)
**物理意义：** 从关节3 (肘部) 到末端法兰中心的变换。
**计算路径：** ${}^3T_4 \cdot {}^4T_6$
*注意：关节4的 $\alpha_4 = 90^\circ$ 和 $d_4$ 在此引入。*

$$
{}^3T_6 = \begin{bmatrix}
c_4 c_5 c_6 - s_4 s_6 & -c_4 c_5 s_6 - s_4 c_6 & -c_4 s_5 & -d_6 c_4 s_5 \\
s_4 c_5 c_6 + c_4 s_6 & -s_4 c_5 s_6 + c_4 c_6 & -s_4 s_5 & -d_6 s_4 s_5 \\
s_5 c_6 & -s_5 s_6 & c_5 & d_6 c_5 + d_4 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

---

### 3. 矩阵 ${}^2T_5$ (T52)
**物理意义：** 从关节2到关节5 (手腕中心) 的变换。
**用途：** 这是推导 ${}^1T_5$ 的核心部分，去除了 $\theta_1$ 和 $a_2$ 的影响，常用于求 $\theta_2, \theta_3$。

$$
{}^2T_5 = \begin{bmatrix}
c_3 c_4 c_5 - s_3 s_5 & -c_3 s_4 & -c_3 c_4 s_5 - s_3 c_5 & a_3 c_3 - d_4 s_3 \\
s_3 c_4 c_5 + c_3 s_5 & -s_3 s_4 & -s_3 c_4 s_5 + c_3 c_5 & a_3 s_3 + d_4 c_3 \\
-s_4 c_5 & -c_4 & s_4 s_5 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
*(注：第4列即位置向量，表示从关节2原点到手腕中心在关节2坐标系下的投影)*

---

### 4. 矩阵 ${}^2T_6$ (T62)
**物理意义：** 从关节2到末端法兰中心的完整变换。
**计算路径：** ${}^2T_5 \cdot {}^5T_6$

$$
{}^2T_6 = \begin{bmatrix}
r_{11} & r_{12} & r_{13} & p_x \\
r_{21} & r_{22} & r_{23} & p_y \\
r_{31} & r_{32} & r_{33} & p_z \\
0 & 0 & 0 & 1
\end{bmatrix}
$$


$$
{}^2T_6 = \begin{bmatrix}
(c_3 c_4 c_5 - s_3 s_5)c_6 - c_3 s_4 s_6 & -(c_3 c_4 c_5 - s_3 s_5)s_6 - c_3 s_4 c_6 & -c_3 c_4 s_5 - s_3 c_5 & a_3 c_3 - d_4 s_3 + d_6(-c_3 c_4 s_5 - s_3 c_5) \\
(s_3 c_4 c_5 + c_3 s_5)c_6 - s_3 s_4 s_6 & -(s_3 c_4 c_5 + c_3 s_5)s_6 - s_3 s_4 c_6 & -s_3 c_4 s_5 + c_3 c_5 & a_3 s_3 + d_4 c_3 + d_6(-s_3 c_4 s_5 + c_3 c_5) \\
-s_4 c_5 c_6 - c_4 s_6 & s_4 c_5 s_6 - c_4 c_6 & s_4 s_5 & d_6 s_4 s_5 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$


**矩阵元素详情：**

*   **第1行:**
    *   $r_{11} = (c_3 c_4 c_5 - s_3 s_5)c_6 - c_3 s_4 s_6$
    *   $r_{12} = -(c_3 c_4 c_5 - s_3 s_5)s_6 - c_3 s_4 c_6$
    *   $r_{13} = -c_3 c_4 s_5 - s_3 c_5$
    *   $p_x = a_3 c_3 - d_4 s_3 + d_6(-c_3 c_4 s_5 - s_3 c_5)$

*   **第2行:**
    *   $r_{21} = (s_3 c_4 c_5 + c_3 s_5)c_6 - s_3 s_4 s_6$
    *   $r_{22} = -(s_3 c_4 c_5 + c_3 s_5)s_6 - s_3 s_4 c_6$
    *   $r_{23} = -s_3 c_4 s_5 + c_3 c_5$
    *   $p_y = a_3 s_3 + d_4 c_3 + d_6(-s_3 c_4 s_5 + c_3 c_5)$

*   **第3行:**
    *   $r_{31} = -s_4 c_5 c_6 - c_4 s_6$
    *   $r_{32} = s_4 c_5 s_6 - c_4 c_6$
    *   $r_{33} = s_4 s_5$
    *   $p_z = d_6 s_4 s_5$


# 中间变换矩阵推导

下面按标准 DH 矩阵继续推导三个中间量：${}^{1}T_{4}$、${}^{1}T_{5}$、${}^{2}T_{5}$。

采用简写：
$$c_{23}=c_2c_3-s_2s_3,\quad s_{23}=c_2s_3+c_3s_2$$

其中 $c_i=\cos\theta_i$，$s_i=\sin\theta_i$。

---

## 1) ${}^{1}T_{4} = {}^{1}T_{2} \cdot {}^{2}T_{3} \cdot {}^{3}T_{4} = {}^{1}T_{3} \cdot {}^{3}T_{4}$

### 已知：

$${}^{1}T_{3}=
\begin{bmatrix}
c_{23} & 0 & -s_{23} & a_{2}c_{2}+a_{3}c_{23}\\
s_{23} & 0 & c_{23} & a_{2}s_{2}+a_{3}s_{23}\\
0 & -1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}$$

$${}^{3}T_{4}=
\begin{bmatrix}
c_4 & 0 & s_4 & 0\\
s_4 & 0 & -c_4 & 0\\
0 & 1 & 0 & d_4\\
0 & 0 & 0 & 1
\end{bmatrix}$$

### 结果：

$$\boxed{{}^{1}T_{4}=
\begin{bmatrix}
c_{23}c_4 & -s_{23} & c_{23}s_4 & a_{2}c_{2}+a_{3}c_{23}-d_4 s_{23}\\
s_{23}c_4 & c_{23} & s_{23}s_4 & a_{2}s_{2}+a_{3}s_{23}+d_4 c_{23}\\
-s_4 & 0 & c_4 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

## 2) ${}^{1}T_{5} = {}^{1}T_{4} \cdot {}^{4}T_{5}$

### 已知：

$${}^{4}T_{5}=
\begin{bmatrix}
c_5 & 0 & -s_5 & 0\\
s_5 & 0 & c_5 & 0\\
0 & -1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}$$

### 结果：

$$\boxed{{}^{1}T_{5}=
\begin{bmatrix}
c_5c_{23}c_4-s_5s_{23} & -c_{23}s_4 & -c_5s_{23}-c_{23}c_4s_5 & a_{2}c_{2}+a_{3}c_{23}-d_4 s_{23}\\
c_5s_{23}c_4+c_{23}s_5 & -s_{23}s_4 & c_5c_{23}-s_{23}c_4s_5 & a_{2}s_{2}+a_{3}s_{23}+d_4 c_{23}\\
-c_5s_4 & -c_4 & s_4s_5 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

> **自检点**：由于 ${}^{4}T_{5}$ 的平移为 0，所以 ${}^{1}T_{5}$ 的平移列与 ${}^{1}T_{4}$ 完全相同。

---

## 3) ${}^{2}T_{5} = {}^{2}T_{3} \cdot {}^{3}T_{4} \cdot {}^{4}T_{5}$

### 中间步骤 - ${}^{3}T_{5}={}^3T_4 \cdot {}^4T_5$：

$${}^{3}T_{5}=
\begin{bmatrix}
c_4c_5 & -s_4 & -c_4s_5 & 0\\
s_4c_5 & c_4 & -s_4s_5 & 0\\
s_5 & 0 & c_5 & d_4\\
0 & 0 & 0 & 1
\end{bmatrix}$$

### 已知：

$${}^{2}T_{3}=
\begin{bmatrix}
c_3 & 0 & -s_3 & a_3 c_3\\
s_3 & 0 & c_3 & a_3 s_3\\
0 & -1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}$$

### 结果：

$$\boxed{{}^{2}T_{5}=
\begin{bmatrix}
c_3c_4c_5-s_3s_5 & -c_3s_4 & -c_3c_4s_5-s_3c_5 & a_3c_3-d_4s_3\\
s_3c_4c_5+c_3s_5 & -s_3s_4 & -s_3c_4s_5+c_3c_5 & a_3s_3+d_4c_3\\
-s_4c_5 & -c_4 & s_4s_5 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

## 汇总表

| 变换矩阵 | 旋转部分特点 | 平移列 |
|: --------:|:------------|:-------|
| ${}^{1}T_{4}$ | 含 $c_{23}, s_{23}, c_4, s_4$ | $(a_2c_2+a_3c_{23}-d_4s_{23},\; a_2s_2+a_3s_{23}+d_4c_{23},\; 0)^T$ |
| ${}^{1}T_{5}$ | 含 $c_{23}, s_{23}, c_4, s_4, c_5, s_5$ | 同 ${}^{1}T_{4}$ |
| ${}^{2}T_{5}$ | 含 $c_3, s_3, c_4, s_4, c_5, s_5$ | $(a_3c_3-d_4s_3,\; a_3s_3+d_4c_3,\; 0)^T$ |

---

## MATLAB 验证代码

```matlab
%% 符号验证
syms c2 s2 c3 s3 c4 s4 c5 s5 a2 a3 d4 real
c23 = c2*c3 - s2*s3;
s23 = c2*s3 + c3*s2;

% T14
T14 = [c23*c4,  -s23,  c23*s4,  a2*c2 + a3*c23 - d4*s23;
       s23*c4,   c23,  s23*s4,  a2*s2 + a3*s23 + d4*c23;
          -s4,     0,      c4,                        0;
            0,     0,       0,                        1];

% T15
T15 = [c5*c23*c4 - s5*s23,  -c23*s4,  -c5*s23 - c23*c4*s5,  a2*c2 + a3*c23 - d4*s23;
       c5*s23*c4 + c23*s5,  -s23*s4,   c5*c23 - s23*c4*s5,  a2*s2 + a3*s23 + d4*c23;
                  -c5*s4,      -c4,              s4*s5,                        0;
                       0,        0,                  0,                        1];

% T25
T25 = [c3*c4*c5 - s3*s5,  -c3*s4,  -c3*c4*s5 - s3*c5,  a3*c3 - d4*s3;
       s3*c4*c5 + c3*s5,  -s3*s4,  -s3*c4*s5 + c3*c5,  a3*s3 + d4*c3;
              -s4*c5,      -c4,              s4*s5,              0;
                   0,        0,                  0,              1];

disp('T14 = '); disp(T14);
disp('T15 = '); disp(T15);
disp('T25 = '); disp(T25);
```



好的，为了得到完整的 ${}^{0}T_{6}$ 表达式，我们将按照“先手腕（后三关节）、后手臂（前三关节）、最后综合”的顺序进行推导。这种分块计算不仅易于理解，也便于后续进行运动学逆解。
为了公式简洁，我们引入以下组合角的简写：
*   $s_{23} = \sin(\theta_2 + \theta_3) = s_2 c_3 + c_2 s_3$
*   $c_{23} = \cos(\theta_2 + \theta_3) = c_2 c_3 - s_2 s_3$
---
### 1. 手腕部分的变换矩阵 (${ }^{3}T_{6}$)
这一部分由关节 4、5、6 组成，主要决定末端的姿态。我们将 ${}^{3}T_{4}$、${}^{4}T_{5}$、${}^{5}T_{6}$ 依次相乘。
$$ {}^{3}T_{6} = {}^{3}T_{4} \cdot {}^{4}T_{5} \cdot {}^{5}T_{6} $$
经过矩阵乘法运算（省略中间繁琐的标量运算步骤），得到结果如下：
$$
{}^{3}T_{6} = \begin{bmatrix}
c_4 c_5 c_6 - s_4 s_6 & -c_4 c_5 s_6 - s_4 c_6 & c_4 s_5 & -d_6 c_4 s_5 \\
s_4 c_5 c_6 + c_4 s_6 & -s_4 c_5 s_6 + c_4 c_6 & s_4 s_5 & -d_6 s_4 s_5 \\
-s_5 c_6 & s_5 s_6 & c_5 & d_4 + d_6 c_5 \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
---
### 2. 手臂部分的变换矩阵 (${ }^{0}T_{3}$)
这一部分由关节 1、2、3 组成，主要决定手腕中心的位置。
$$ {}^{0}T_{3} = {}^{0}T_{1} \cdot {}^{1}T_{2} \cdot {}^{2}T_{3} $$
利用 $s_{23}$ 和 $c_{23}$ 进行化简，结果如下：
$$
{}^{0}T_{3} = \begin{bmatrix}
c_1 c_{23} & s_1 & -c_1 s_{23} & c_1 (a_1 + a_2 c_2 + a_3 c_{23}) \\
s_1 c_{23} & -c_1 & -s_1 s_{23} & s_1 (a_1 + a_2 c_2 + a_3 c_{23}) \\
-s_{23} & 0 & c_{23} & d_1 - a_2 s_2 - a_3 s_{23} \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
---
### 3. 完整的正运动学方程 (${ }^{0}T_{6}$)
现在我们将 ${}^{0}T_{3}$ 和 ${}^{3}T_{6}$ 相乘：
$$ {}^{0}T_{6} = {}^{0}T_{3} \cdot {}^{3}T_{6} $$
设最终矩阵为：
$$
{}^{0}T_{6} = \begin{bmatrix}
n_x & o_x & a_x & p_x \\
n_y & o_y & a_y & p_y \\
n_z & o_z & a_z & p_z \\
0 & 0 & 0 & 1
\end{bmatrix}
$$
由于完整矩阵较大，我们先提取最重要的 **位置向量 ($p_x, p_y, p_z$)**，这是机械臂末端在基坐标系下的坐标。
#### **3.1 位置向量 ($P$)**
$$
\begin{aligned}
p_x &= c_1 [a_1 + a_2 c_2 + a_3 c_{23} - d_4 s_{23} - d_6(c_{23} c_4 s_5 + s_{23} c_5)] - s_1 d_6 s_4 s_5 \\
p_y &= s_1 [a_1 + a_2 c_2 + a_3 c_{23} - d_4 s_{23} - d_6(c_{23} c_4 s_5 + s_{23} c_5)] + c_1 d_6 s_4 s_5 \\
p_z &= d_1 - a_2 s_2 - a_3 s_{23} + d_4 c_{23} + d_6(c_{23} c_5 - s_{23} c_4 s_5)
\end{aligned}
$$
> **注意：** 如果是进行位置逆解（IK），通常先计算**手腕中心**的位置，即 $d_6=0$ 时的位置，这样可以消去包含 $\theta_4, \theta_5, \theta_6$ 的项。
#### **3.2 旋转矩阵 ($R$)**
旋转部分由 ${}^{0}R_{3}$ 和 ${}^{3}R_{6}$ 相乘得到。为了避免写成极其冗长的单行公式，我们用分块乘积的形式表示每一列（这里 $n, o, a$ 分别代表法线、方向、接近向量）：
**列向量 $n$ (对应旋转矩阵第1列):**
$$
\begin{bmatrix}
c_1 c_{23}(c_4 c_5 c_6 - s_4 s_6) + s_1(s_4 c_5 c_6 + c_4 s_6) - c_1 s_{23} s_5 c_6 \\
s_1 c_{23}(c_4 c_5 c_6 - s_4 s_6) - c_1(s_4 c_5 c_6 + c_4 s_6) - s_1 s_{23} s_5 c_6 \\
-s_{23}(c_4 c_5 c_6 - s_4 s_6) + c_{23} s_5 c_6
\end{bmatrix}
$$
**列向量 $o$ (对应旋转矩阵第2列):**
$$
\begin{bmatrix}
c_1 c_{23}(-c_4 c_5 s_6 - s_4 c_6) + s_1(-s_4 c_5 s_6 + c_4 c_6) + c_1 s_{23} s_5 s_6 \\
s_1 c_{23}(-c_4 c_5 s_6 - s_4 c_6) - c_1(-s_4 c_5 s_6 + c_4 c_6) + s_1 s_{23} s_5 s_6 \\
-s_{23}(-c_4 c_5 s_6 - s_4 c_6) - c_{23} s_5 s_6
\end{bmatrix}
$$
**列向量 $a$ (对应旋转矩阵第3列，即末端执行器的 Z 轴方向):**
$$
\begin{bmatrix}
c_1 c_{23} c_4 s_5 + s_1 s_4 s_5 + c_1 s_{23} c_5 \\
s_1 c_{23} c_4 s_5 - c_1 s_4 s_5 + s_1 s_{23} c_5 \\
-s_{23} c_4 s_5 + c_{23} c_5
\end{bmatrix}
$$
---
### 4. 总结与编程建议
在编写程序（如 MATLAB 或 Python）时，**不要手动硬编码**上面这些展开后的长公式，因为极易出错且难以维护。
**推荐的计算流程是：**
```python
# 伪代码示例
def forward_kinematics(theta):
    # 1. 定义 DH 参数
    d = [d1, 0, 0, d4, 0, d6]
    a = [a1, a2, a3, 0, 0, 0]
    alpha = [-pi/2, 0, -pi/2, pi/2, -pi/2, 0]
    
    T_total = eye(4)
    
    # 2. 循环构建矩阵并相乘
    for i in range(6):
        ct, st = cos(theta[i]), sin(theta[i])
        ca, sa = cos(alpha[i]), sin(alpha[i])
        
        # 构建当前关节的变换矩阵
        Ti = [
            [ct, -st*ca,  st*sa, a[i]*ct],
            [st,  ct*ca, -ct*sa, a[i]*st],
            [0,   sa,     ca,    d[i]],
            [0,   0,      0,     1]
        ]
        T_total = T_total @ Ti  # 矩阵乘法
    return T_total
```
这种方法既利用了符号推导的通用性，又保证了数值计算的精确性。上面推导出的 ${}^{0}T_{6}$ 表达式主要用于验证你的代码是否正确，或者用于推导逆运动学的解析解。




# 矩阵 $\mathbf{M}$ 的显式推导

本文推导乘积矩阵：
$$\mathbf{M} = ({}^{0}T_{1})^{-1} \cdot {}^{0}T_{6} \cdot ({}^{5}T_{6})^{-1} \cdot ({}^{4}T_{5})^{-1}$$

其中 ${}^{0}T_6$ 用末端位姿 $(n, o, a, p)$ 表示。

---

## 0) 各逆矩阵

### (1) $({}^{0}T_{1})^{-1}$

已知：
$${}^{0}T_{1}=
\begin{bmatrix}
c_1 & 0 & -s_1 & a_1c_1\\
s_1 & 0 & c_1 & a_1s_1\\
0 & -1 & 0 & d_1\\
0 & 0 & 0 & 1
\end{bmatrix}$$

其逆为（利用 $R^{-1}=R^{\mathsf T}$，平移 $-R^{\mathsf T}p$）：

$$\boxed{({}^{0}T_{1})^{-1}=
\begin{bmatrix}
c_1 & s_1 & 0 & -a_1\\
0 & 0 & -1 & d_1\\
-s_1 & c_1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

### (2) $({}^{5}T_{6})^{-1}$

$${}^{5}T_{6}=
\begin{bmatrix}
c_6 & -s_6 & 0 & 0\\
s_6 & c_6 & 0 & 0\\
0 & 0 & 1 & d_6\\
0 & 0 & 0 & 1
\end{bmatrix}
\Rightarrow
\boxed{({}^{5}T_{6})^{-1}=
\begin{bmatrix}
c_6 & s_6 & 0 & 0\\
-s_6 & c_6 & 0 & 0\\
0 & 0 & 1 & -d_6\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

### (3) $({}^{4}T_{5})^{-1}$

$${}^{4}T_{5}=
\begin{bmatrix}
c_5 & 0 & -s_5 & 0\\
s_5 & 0 & c_5 & 0\\
0 & -1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}
\Rightarrow
\boxed{({}^{4}T_{5})^{-1}=
\begin{bmatrix}
c_5 & s_5 & 0 & 0\\
0 & 0 & -1 & 0\\
-s_5 & c_5 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

## 1) 代入 ${}^{0}T_6 = [n\ o\ a\ p]$ 并化简

### 末端位姿表示

$${}^{0}T_6=
\begin{bmatrix}
n_x & o_x & a_x & p_x\\
n_y & o_y & a_y & p_y\\
n_z & o_z & a_z & p_z\\
0 & 0 & 0 & 1
\end{bmatrix}
=
\begin{bmatrix}
R_{06} & p\\
0 & 1
\end{bmatrix},
\quad R_{06}=[n\ \ o\ \ a]$$

### 合并右侧两个逆矩阵

$$\mathbf{B}=({}^{5}T_{6})^{-1}({}^{4}T_{5})^{-1}
=
\begin{bmatrix}
c_6c_5 & c_6s_5 & -s_6 & 0\\
-s_6c_5 & -s_6s_5 & -c_6 & 0\\
-s_5 & c_5 & 0 & -d_6\\
0 & 0 & 0 & 1
\end{bmatrix}$$

### 定义辅助向量

$$u=
\begin{bmatrix}
c_6 n_x - s_6 o_x\\
c_6 n_y - s_6 o_y\\
c_6 n_z - s_6 o_z
\end{bmatrix},\quad
v=
\begin{bmatrix}
s_6 n_x + c_6 o_x\\
s_6 n_y + c_6 o_y\\
s_6 n_z + c_6 o_z
\end{bmatrix}$$

则：
$$R_{06} \cdot R_B = \big[\,c_5 u - s_5 a\ \ \ s_5 u + c_5 a\ \ \ -v\,\big]$$

---

## 2) 最终矩阵 $\mathbf{M}$ 的显式表达

### 旋转部分 $R_M$ 的三列

**第 1 列**：$w^{(1)} = c_5 u - s_5 a$

$$R_M(: ,1)=
\begin{bmatrix}
c_1(c_5 u_x - s_5 a_x) + s_1(c_5 u_y - s_5 a_y)\\
-(c_5 u_z - s_5 a_z)\\
-s_1(c_5 u_x - s_5 a_x) + c_1(c_5 u_y - s_5 a_y)
\end{bmatrix}$$

**第 2 列**：$w^{(2)} = s_5 u + c_5 a$

$$R_M(: ,2)=
\begin{bmatrix}
c_1(s_5 u_x + c_5 a_x) + s_1(s_5 u_y + c_5 a_y)\\
-(s_5 u_z + c_5 a_z)\\
-s_1(s_5 u_x + c_5 a_x) + c_1(s_5 u_y + c_5 a_y)
\end{bmatrix}$$

**第 3 列**：$w^{(3)} = -v$

$$R_M(: ,3)=
\begin{bmatrix}
-(c_1 v_x + s_1 v_y)\\
v_z\\
s_1 v_x - c_1 v_y
\end{bmatrix}$$

### 平移部分 $p_M$

$$p_M=
\begin{bmatrix}
c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1\\
-(p_z - d_6 a_z) + d_1\\
-s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)
\end{bmatrix}$$

---

## 3) 完整的 $\mathbf{M}$ 矩阵

将 $u$、$v$ 展开后，得到完整的显式表达：

$$\boxed{
\mathbf{M} = 
\begin{bmatrix}
m_{11} & m_{12} & m_{13} & m_{14}\\
m_{21} & m_{22} & m_{23} & m_{24}\\
m_{31} & m_{32} & m_{33} & m_{34}\\
0 & 0 & 0 & 1
\end{bmatrix}
}$$


$$
\mathbf{M} = 
\begin{bmatrix}
c_1[c_5(c_6 n_x - s_6 o_x) - s_5 a_x] + s_1[c_5(c_6 n_y - s_6 o_y) - s_5 a_y] & c_1[s_5(c_6 n_x - s_6 o_x) + c_5 a_x] + s_1[s_5(c_6 n_y - s_6 o_y) + c_5 a_y] & -c_1(s_6 n_x + c_6 o_x) - s_1(s_6 n_y + c_6 o_y) & c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1\\
-c_5(c_6 n_z - s_6 o_z) + s_5 a_z & -s_5(c_6 n_z - s_6 o_z) - c_5 a_z & s_6 n_z + c_6 o_z & -(p_z - d_6 a_z) + d_1 = -p_z + d_6 a_z + d_1\\
-s_1[c_5(c_6 n_x - s_6 o_x) - s_5 a_x] + c_1[c_5(c_6 n_y - s_6 o_y) - s_5 a_y] & -s_1[s_5(c_6 n_x - s_6 o_x) + c_5 a_x] + c_1[s_5(c_6 n_y - s_6 o_y) + c_5 a_y] & s_1(s_6 n_x + c_6 o_x) - c_1(s_6 n_y + c_6 o_y) & -s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)\\
0 & 0 & 0 & 1
\end{bmatrix}
$$

其中各元素为：

### 第一行

$$\begin{aligned}
m_{11} &= c_1[c_5(c_6 n_x - s_6 o_x) - s_5 a_x] + s_1[c_5(c_6 n_y - s_6 o_y) - s_5 a_y]\\
m_{12} &= c_1[s_5(c_6 n_x - s_6 o_x) + c_5 a_x] + s_1[s_5(c_6 n_y - s_6 o_y) + c_5 a_y]\\
m_{13} &= -c_1(s_6 n_x + c_6 o_x) - s_1(s_6 n_y + c_6 o_y)\\
m_{14} &= c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1
\end{aligned}$$

### 第二行

$$\begin{aligned}
m_{21} &= -c_5(c_6 n_z - s_6 o_z) + s_5 a_z\\
m_{22} &= -s_5(c_6 n_z - s_6 o_z) - c_5 a_z\\
m_{23} &= s_6 n_z + c_6 o_z\\
m_{24} &= -(p_z - d_6 a_z) + d_1 = -p_z + d_6 a_z + d_1
\end{aligned}$$

### 第三行

$$\begin{aligned}
m_{31} &= -s_1[c_5(c_6 n_x - s_6 o_x) - s_5 a_x] + c_1[c_5(c_6 n_y - s_6 o_y) - s_5 a_y]\\
m_{32} &= -s_1[s_5(c_6 n_x - s_6 o_x) + c_5 a_x] + c_1[s_5(c_6 n_y - s_6 o_y) + c_5 a_y]\\
m_{33} &= s_1(s_6 n_x + c_6 o_x) - c_1(s_6 n_y + c_6 o_y)\\
m_{34} &= -s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)
\end{aligned}$$

---

## 4) 关键等式（用于逆运动学）

由于：
$${}^{0}T_6 = {}^{0}T_1 \cdot {}^{1}T_2 \cdot {}^{2}T_3 \cdot {}^{3}T_4 \cdot {}^{4}T_5 \cdot {}^{5}T_6$$

因此：
$$\mathbf{M} = {}^{1}T_2 \cdot {}^{2}T_3 \cdot {}^{3}T_4 = {}^{1}T_4$$

也就是说，上面用 $(n, o, a, p)$ 表示的矩阵 $\mathbf{M}$，**恒等于之前推导的 ${}^{1}T_4$**：

$${}^{1}T_{4}=
\begin{bmatrix}
c_{23}c_4 & -s_{23} & c_{23}s_4 & a_{2}c_{2}+a_{3}c_{23}-d_4 s_{23}\\
s_{23}c_4 & c_{23} & s_{23}s_4 & a_{2}s_{2}+a_{3}s_{23}+d_4 c_{23}\\
-s_4 & 0 & c_4 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}$$

**逐元素对应，即可建立求解 $\theta_2, \theta_3, \theta_4$ 的方程组。**

---

## 5) MATLAB 验证代码

```matlab
%% M 矩阵符号计算验证
syms c1 s1 c5 s5 c6 s6 real
syms nx ny nz ox oy oz ax ay az px py pz real
syms a1 d1 d6 real

% 辅助向量
ux = c6*nx - s6*ox;
uy = c6*ny - s6*oy;
uz = c6*nz - s6*oz;

vx = s6*nx + c6*ox;
vy = s6*ny + c6*oy;
vz = s6*nz + c6*oz;

% M 矩阵各元素
m11 = c1*(c5*ux - s5*ax) + s1*(c5*uy - s5*ay);
m12 = c1*(s5*ux + c5*ax) + s1*(s5*uy + c5*ay);
m13 = -c1*vx - s1*vy;
m14 = c1*(px - d6*ax) + s1*(py - d6*ay) - a1;

m21 = -c5*uz + s5*az;
m22 = -s5*uz - c5*az;
m23 = vz;
m24 = -pz + d6*az + d1;

m31 = -s1*(c5*ux - s5*ax) + c1*(c5*uy - s5*ay);
m32 = -s1*(s5*ux + c5*ax) + c1*(s5*uy + c5*ay);
m33 = s1*vx - c1*vy;
m34 = -s1*(px - d6*ax) + c1*(py - d6*ay);

% 完整 M 矩阵
M = [m11, m12, m13, m14;
     m21, m22, m23, m24;
     m31, m32, m33, m34;
       0,   0,   0,   1];

disp('M = ');
disp(M);
```


# 矩阵 $\mathbf{M}_{15}$ 的显式推导

本文推导乘积矩阵：
$$\mathbf{M}_{15} = ({}^{0}T_{1})^{-1} \cdot {}^{0}T_{6} \cdot ({}^{5}T_{6})^{-1}$$

其中 ${}^{0}T_6$ 用末端位姿 $(n, o, a, p)$ 表示。

---

## 1) 已知矩阵与其逆

### $({}^{0}T_{1})^{-1}$

已知：
$${}^{0}T_{1}=
\begin{bmatrix}
c_1 & 0 & -s_1 & a_1c_1\\
s_1 & 0 & c_1 & a_1s_1\\
0 & -1 & 0 & d_1\\
0 & 0 & 0 & 1
\end{bmatrix}$$

其逆为：
$$\boxed{({}^{0}T_{1})^{-1}=
\begin{bmatrix}
c_1 & s_1 & 0 & -a_1\\
0 & 0 & -1 & d_1\\
-s_1 & c_1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

### ${}^{0}T_6$（末端位姿表示）

$${}^{0}T_{6}=
\begin{bmatrix}
n_x & o_x & a_x & p_x\\
n_y & o_y & a_y & p_y\\
n_z & o_z & a_z & p_z\\
0 & 0 & 0 & 1
\end{bmatrix}
=\begin{bmatrix}R_{06} & p\\ 0 & 1\end{bmatrix},\quad
R_{06}=[n\ \ o\ \ a]$$

---

### $({}^{5}T_{6})^{-1}$

$${}^{5}T_{6}=
\begin{bmatrix}
c_6 & -s_6 & 0 & 0\\
s_6 & c_6 & 0 & 0\\
0 & 0 & 1 & d_6\\
0 & 0 & 0 & 1
\end{bmatrix}
\Rightarrow
\boxed{({}^{5}T_{6})^{-1}=
\begin{bmatrix}
c_6 & s_6 & 0 & 0\\
-s_6 & c_6 & 0 & 0\\
0 & 0 & 1 & -d_6\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

## 2) 中间项 ${}^{0}T_{6}({}^{5}T_{6})^{-1}$

$${}^{0}T_{6}({}^{5}T_{6})^{-1}
=
\begin{bmatrix}
R_{06}R_z(\theta_6)^{\mathsf T} & p-d_6 a\\
0 & 1
\end{bmatrix}$$

### 平移部分

$$p - d_6 a =
\begin{bmatrix}
p_x - d_6 a_x\\
p_y - d_6 a_y\\
p_z - d_6 a_z
\end{bmatrix}$$

### 旋转部分

$$R_{06}R_z(\theta_6)^{\mathsf T}
=
\big[\,c_6 n - s_6 o\ \ \ s_6 n + c_6 o\ \ \ a\,\big]$$

即三列分别为：

$$\text{第1列} = \begin{bmatrix}c_6 n_x - s_6 o_x\\ c_6 n_y - s_6 o_y\\ c_6 n_z - s_6 o_z\end{bmatrix},\quad
\text{第2列} = \begin{bmatrix}s_6 n_x + c_6 o_x\\ s_6 n_y + c_6 o_y\\ s_6 n_z + c_6 o_z\end{bmatrix},\quad
\text{第3列} = \begin{bmatrix}a_x\\ a_y\\ a_z\end{bmatrix}$$

---

## 3) 左乘 $({}^{0}T_1)^{-1}$

令：
$$R_{10}=
\begin{bmatrix}
c_1 & s_1 & 0\\
0 & 0 & -1\\
-s_1 & c_1 & 0
\end{bmatrix},\quad
t_{10}=
\begin{bmatrix}-a_1\\ d_1\\ 0\end{bmatrix}$$

则：
$$\mathbf{M}_{15}
=
\begin{bmatrix}
R_{10}\big(R_{06}R_z^{\mathsf T}\big) & R_{10}(p-d_6 a)+t_{10}\\
0 & 1
\end{bmatrix}$$

---

## 4) 完整的显式 4×4 矩阵

### 辅助向量定义

$$u = c_6 n - s_6 o,\qquad v = s_6 n + c_6 o$$

即：
$$\begin{aligned}
u_x &= c_6 n_x - s_6 o_x,\quad u_y = c_6 n_y - s_6 o_y,\quad u_z = c_6 n_z - s_6 o_z\\
v_x &= s_6 n_x + c_6 o_x,\quad v_y = s_6 n_y + c_6 o_y,\quad v_z = s_6 n_z + c_6 o_z
\end{aligned}$$

### 旋转部分 $R_{15}$

$$R_{15}=
\begin{bmatrix}
c_1 u_x + s_1 u_y & c_1 v_x + s_1 v_y & c_1 a_x + s_1 a_y\\
-u_z & -v_z & -a_z\\
-s_1 u_x + c_1 u_y & -s_1 v_x + c_1 v_y & -s_1 a_x + c_1 a_y
\end{bmatrix}$$

展开后：
$$R_{15}=
\begin{bmatrix}
c_1(c_6 n_x - s_6 o_x) + s_1(c_6 n_y - s_6 o_y) & c_1(s_6 n_x + c_6 o_x) + s_1(s_6 n_y + c_6 o_y) & c_1 a_x + s_1 a_y\\
-(c_6 n_z - s_6 o_z) & -(s_6 n_z + c_6 o_z) & -a_z\\
-s_1(c_6 n_x - s_6 o_x) + c_1(c_6 n_y - s_6 o_y) & -s_1(s_6 n_x + c_6 o_x) + c_1(s_6 n_y + c_6 o_y) & -s_1 a_x + c_1 a_y
\end{bmatrix}$$

### 平移部分 $p_{15}$

令 $p' = p - d_6 a$，则：

$$p_{15} = R_{10} p' + t_{10} =
\begin{bmatrix}
c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1\\
-(p_z - d_6 a_z) + d_1\\
-s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)
\end{bmatrix}$$

---

## 5) 完整的 $\mathbf{M}_{15}$ 矩阵

$$\boxed{
\mathbf{M}_{15} = 
\begin{bmatrix}
m_{11} & m_{12} & m_{13} & m_{14}\\
m_{21} & m_{22} & m_{23} & m_{24}\\
m_{31} & m_{32} & m_{33} & m_{34}\\
0 & 0 & 0 & 1
\end{bmatrix}
}$$


$${
\mathbf{M}_{15} = 
\begin{bmatrix}
c_1(c_6 n_x - s_6 o_x) + s_1(c_6 n_y - s_6 o_y) & c_1(s_6 n_x + c_6 o_x) + s_1(s_6 n_y + c_6 o_y) & c_1 a_x + s_1 a_y & c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1\\
-(c_6 n_z - s_6 o_z) = -c_6 n_z + s_6 o_z & -(s_6 n_z + c_6 o_z) = -s_6 n_z - c_6 o_z & -a_z & -(p_z - d_6 a_z) + d_1 = -p_z + d_6 a_z + d_1\\
-s_1(c_6 n_x - s_6 o_x) + c_1(c_6 n_y - s_6 o_y) & -s_1(s_6 n_x + c_6 o_x) + c_1(s_6 n_y + c_6 o_y) & -s_1 a_x + c_1 a_y & -s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)\\
0 & 0 & 0 & 1
\end{bmatrix}
}$$

其中各元素为：

### 第一行

$$\begin{aligned}
m_{11} &= c_1(c_6 n_x - s_6 o_x) + s_1(c_6 n_y - s_6 o_y)\\
m_{12} &= c_1(s_6 n_x + c_6 o_x) + s_1(s_6 n_y + c_6 o_y)\\
m_{13} &= c_1 a_x + s_1 a_y\\
m_{14} &= c_1(p_x - d_6 a_x) + s_1(p_y - d_6 a_y) - a_1
\end{aligned}$$

### 第二行

$$\begin{aligned}
m_{21} &= -(c_6 n_z - s_6 o_z) = -c_6 n_z + s_6 o_z\\
m_{22} &= -(s_6 n_z + c_6 o_z) = -s_6 n_z - c_6 o_z\\
m_{23} &= -a_z\\
m_{24} &= -(p_z - d_6 a_z) + d_1 = -p_z + d_6 a_z + d_1
\end{aligned}$$

### 第三行

$$\begin{aligned}
m_{31} &= -s_1(c_6 n_x - s_6 o_x) + c_1(c_6 n_y - s_6 o_y)\\
m_{32} &= -s_1(s_6 n_x + c_6 o_x) + c_1(s_6 n_y + c_6 o_y)\\
m_{33} &= -s_1 a_x + c_1 a_y\\
m_{34} &= -s_1(p_x - d_6 a_x) + c_1(p_y - d_6 a_y)
\end{aligned}$$

---

## 6) 关键等式（用于逆运动学）

由于：
$${}^{0}T_6 = {}^{0}T_1 \cdot {}^{1}T_2 \cdot {}^{2}T_3 \cdot {}^{3}T_4 \cdot {}^{4}T_5 \cdot {}^{5}T_6$$

因此：
$$\mathbf{M}_{15} = {}^{1}T_2 \cdot {}^{2}T_3 \cdot {}^{3}T_4 \cdot {}^{4}T_5 = {}^{1}T_5$$

也就是说，上面用 $(n, o, a, p)$ 表示的矩阵 $\mathbf{M}_{15}$，**恒等于之前推导的 ${}^{1}T_5$**：

$${}^{1}T_{5}=
\begin{bmatrix}
c_5 c_{23} c_4 - s_5 s_{23} & -c_{23} s_4 & -c_5 s_{23} - c_{23} c_4 s_5 & a_2 c_2 + a_3 c_{23} - d_4 s_{23}\\
c_5 s_{23} c_4 + c_{23} s_5 & -s_{23} s_4 & c_5 c_{23} - s_{23} c_4 s_5 & a_2 s_2 + a_3 s_{23} + d_4 c_{23}\\
-c_5 s_4 & -c_4 & s_4 s_5 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}$$

**逐元素对应，即可建立求解 $\theta_5$ 的方程（通常选第 3 行第 2 列 $m_{32} = -c_4$ 最干净）。**

---

## 7) MATLAB 验证代码

```matlab
%% M15 矩阵符号计算验证
syms c1 s1 c6 s6 real
syms nx ny nz ox oy oz ax ay az px py pz real
syms a1 d1 d6 real

% 辅助向量
ux = c6*nx - s6*ox;
uy = c6*ny - s6*oy;
uz = c6*nz - s6*oz;

vx = s6*nx + c6*ox;
vy = s6*ny + c6*oy;
vz = s6*nz + c6*oz;

% M15 矩阵各元素
m11 = c1*ux + s1*uy;
m12 = c1*vx + s1*vy;
m13 = c1*ax + s1*ay;
m14 = c1*(px - d6*ax) + s1*(py - d6*ay) - a1;

m21 = -uz;
m22 = -vz;
m23 = -az;
m24 = -pz + d6*az + d1;

m31 = -s1*ux + c1*uy;
m32 = -s1*vx + c1*vy;
m33 = -s1*ax + c1*ay;
m34 = -s1*(px - d6*ax) + c1*(py - d6*ay);

% 完整 M15 矩阵
M15 = [m11, m12, m13, m14;
       m21, m22, m23, m24;
       m31, m32, m33, m34;
         0,   0,   0,   1];

disp('M15 = ');
disp(M15);

%% 展开形式验证
M15_expanded = [
    c1*(c6*nx - s6*ox) + s1*(c6*ny - s6*oy), c1*(s6*nx + c6*ox) + s1*(s6*ny + c6*oy), c1*ax + s1*ay, c1*(px - d6*ax) + s1*(py - d6*ay) - a1;
    -(c6*nz - s6*oz), -(s6*nz + c6*oz), -az, -pz + d6*az + d1;
    -s1*(c6*nx - s6*ox) + c1*(c6*ny - s6*oy), -s1*(s6*nx + c6*ox) + c1*(s6*ny + c6*oy), -s1*ax + c1*ay, -s1*(px - d6*ax) + c1*(py - d6*ay);
    0, 0, 0, 1
];

disp('M15 (expanded) = ');
disp(M15_expanded);

% 验证两者相等
disp('Difference (should be zero):');
disp(simplify(M15 - M15_expanded));
```

# 完整 DH 变换矩阵推导

本文给出 6 自由度机械臂的所有必要中间变换矩阵及最终的 ${}^{0}T_{6}$ 显式表达。

## 符号约定

$$c_i = \cos\theta_i,\quad s_i = \sin\theta_i$$

$$c_{23} = \cos(\theta_2 + \theta_3) = c_2 c_3 - s_2 s_3$$

$$s_{23} = \sin(\theta_2 + \theta_3) = c_2 s_3 + c_3 s_2$$

---

## 1) ${}^{1}T_{3} = {}^{1}T_{2} \cdot {}^{2}T_{3}$

$$\boxed{{}^{1}T_{3}=
\begin{bmatrix}
c_{23} & 0 & -s_{23} & a_{2}c_{2}+a_{3}c_{2}c_{3}-a_{3}s_{2}s_{3}\\
s_{23} & 0 & c_{23} & a_{2}s_{2}+a_{3}c_{2}s_{3}+a_{3}c_{3}s_{2}\\
0 & -1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

> **注**：平移项也可简写为 $a_2 c_2 + a_3 c_{23}$ 与 $a_2 s_2 + a_3 s_{23}$。

---

## 2) ${}^{4}T_{6} = {}^{4}T_{5} \cdot {}^{5}T_{6}$

$$\boxed{{}^{4}T_{6}=
\begin{bmatrix}
c_{5}c_{6} & -c_{5}s_{6} & -s_{5} & -d_{6}s_{5}\\
c_{6}s_{5} & -s_{5}s_{6} & c_{5} & c_{5}d_{6}\\
-s_{6} & -c_{6} & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

## 3) ${}^{3}T_{6} = {}^{3}T_{4} \cdot {}^{4}T_{5} \cdot {}^{5}T_{6}$

$$\boxed{{}^{3}T_{6}=
\begin{bmatrix}
c_{4}c_{5}c_{6}-s_{4}s_{6} & -c_{4}c_{5}s_{6}-c_{6}s_{4} & -c_{4}s_{5} & -c_{4}d_{6}s_{5}\\
c_{4}s_{6}+c_{5}c_{6}s_{4} & c_{4}c_{6}-c_{5}s_{4}s_{6} & -s_{4}s_{5} & -d_{6}s_{4}s_{5}\\
c_{6}s_{5} & -s_{5}s_{6} & c_{5} & c_{5}d_{6}+d_{4}\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

---

## 4) ${}^{1}T_{6} = {}^{1}T_{2} \cdot {}^{2}T_{3} \cdot {}^{3}T_{4} \cdot {}^{4}T_{5} \cdot {}^{5}T_{6}$

$$\boxed{{}^{1}T_{6}=
\begin{bmatrix}
r_{11} & r_{12} & r_{13} & p_{1x}\\
r_{21} & r_{22} & r_{23} & p_{1y}\\
r_{31} & r_{32} & r_{33} & p_{1z}\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

$${{}^{1}T_{6}=
\begin{bmatrix}
c_{23} c_{4} c_{5} c_{6} - c_{23} s_{4} s_{6} - c_{6} s_{23} s_{5} & -c_{23} c_{4} c_{5} s_{6} - c_{23} c_{6} s_{4} + s_{23} s_{5} s_{6} & -c_{23} c_{4} s_{5} - c_{5} s_{23} & a_2 c_2 + a_3 c_{23} - d_4 s_{23} - d_6(c_{23} c_4 s_5 + c_5 s_{23})\\
c_{4} c_{5} c_{6} s_{23} - s_{23} s_{4} s_{6} + c_{23} c_{6} s_{5} & -c_{4} c_{5} s_{23} s_{6} - c_{6} s_{23} s_{4} - c_{23} s_{5} s_{6} & -c_{4} s_{23} s_{5} + c_{23} c_{5} & a_2 s_2 + a_3 s_{23} + d_4 c_{23} + d_6(-c_4 s_{23} s_5 + c_{23} c_5)\\
-c_{6} s_{4} c_{5} - c_{4} s_{6} & s_{4} c_{5} s_{6} - c_{4} c_{6} & s_{4} s_{5} & d_4 + d_6 s_4 s_5\\
0 & 0 & 0 & 1
\end{bmatrix}}$$

### 旋转部分各元素

$$\begin{aligned}
r_{11} &= c_{23} c_{4} c_{5} c_{6} - c_{23} s_{4} s_{6} - c_{6} s_{23} s_{5}\\
r_{12} &= -c_{23} c_{4} c_{5} s_{6} - c_{23} c_{6} s_{4} + s_{23} s_{5} s_{6}\\
r_{13} &= -c_{23} c_{4} s_{5} - c_{5} s_{23}
\end{aligned}$$

$$\begin{aligned}
r_{21} &= c_{4} c_{5} c_{6} s_{23} - s_{23} s_{4} s_{6} + c_{23} c_{6} s_{5}\\
r_{22} &= -c_{4} c_{5} s_{23} s_{6} - c_{6} s_{23} s_{4} - c_{23} s_{5} s_{6}\\
r_{23} &= -c_{4} s_{23} s_{5} + c_{23} c_{5}
\end{aligned}$$

$$\begin{aligned}
r_{31} &= -c_{6} s_{4} c_{5} - c_{4} s_{6}\\
r_{32} &= s_{4} c_{5} s_{6} - c_{4} c_{6}\\
r_{33} &= s_{4} s_{5}
\end{aligned}$$

### 平移部分各元素

$$\begin{aligned}
p_{1x} &= a_2 c_2 + a_3 c_{23} - d_4 s_{23} - d_6(c_{23} c_4 s_5 + c_5 s_{23})\\
p_{1y} &= a_2 s_2 + a_3 s_{23} + d_4 c_{23} + d_6(-c_4 s_{23} s_5 + c_{23} c_5)\\
p_{1z} &= d_4 + d_6 s_4 s_5
\end{aligned}$$

---

## 5) 最终 ${}^{0}T_{6} = {}^{0}T_{1} \cdot {}^{1}T_{6}$

$$\boxed{{}^{0}T_{6}=
\begin{bmatrix}
R_{06} & p_{06}\\
0\ 0\ 0 & 1
\end{bmatrix}}$$

### 5.1 旋转部分 $R_{06}$

$$R_{06}=
\begin{bmatrix}
R_{11} & R_{12} & R_{13}\\
R_{21} & R_{22} & R_{23}\\
R_{31} & R_{32} & R_{33}
\end{bmatrix}$$

#### 第一行

$$\begin{aligned}
R_{11} &= -c_{6}\left(c_{1} s_{23} s_{5} - c_{5} (c_{1} c_{23} c_{4} + s_{1} s_{4})\right) - s_{6}\left(c_{1} c_{23} s_{4} - c_{4} s_{1}\right)\\
R_{12} &= c_{6}\left(c_{1} c_{23} s_{4} - c_{4} s_{1}\right) - s_{6}\left(c_{1} s_{23} s_{5} - c_{5} (c_{1} c_{23} c_{4} + s_{1} s_{4})\right)\\
R_{13} &= c_{1} c_{5} s_{23} + s_{5}(c_{1} c_{23} c_{4} + s_{1} s_{4})
\end{aligned}$$

#### 第二行

$$\begin{aligned}
R_{21} &= -c_{6}\left(c_{5}(c_{1} s_{4} - c_{23} c_{4} s_{1}) + s_{1} s_{23} s_{5}\right) - s_{6}\left(c_{1} c_{4} + c_{23} s_{1} s_{4}\right)\\
R_{22} &= c_{6}\left(c_{1} c_{4} + c_{23} s_{1} s_{4}\right) - s_{6}\left(c_{5}(c_{1} s_{4} - c_{23} c_{4} s_{1}) + s_{1} s_{23} s_{5}\right)\\
R_{23} &= c_{5} s_{1} s_{23} - s_{5}(c_{1} s_{4} - c_{23} c_{4} s_{1})
\end{aligned}$$

#### 第三行

$$\begin{aligned}
R_{31} &= -c_{6}(c_{23} s_{5} + c_{4} s_{23} c_{5}) + s_{23} s_{4} s_{6}\\
R_{32} &= -c_{6} s_{23} s_{4} - s_{6}(c_{23} s_{5} + c_{4} s_{23} c_{5})\\
R_{33} &= -c_{23} c_{5} + c_{4} s_{23} s_{5}
\end{aligned}$$

---

### 5.2 平移向量 $p_{06}$

$$p_{06}=
\begin{bmatrix}
p_x\\
p_y\\
p_z
\end{bmatrix}$$

$$\begin{aligned}
p_x &= a_{1}c_{1} + a_{2}c_{1}c_{2} + a_{3}c_{1}c_{23} - d_{4}c_{1}s_{23} - d_{6}\left(c_{1}c_{5}s_{23} + s_{5}(c_{1}c_{23}c_{4} + s_{1}s_{4})\right)\\
p_y &= a_{1}s_{1} + a_{2}s_{1}c_{2} + a_{3}s_{1}c_{23} - d_{4}s_{1}s_{23} - d_{6}\left(c_{5}s_{1}s_{23} - s_{5}(c_{1}s_{4} - c_{23}c_{4}s_{1})\right)\\
p_z &= d_{1} - a_{2}s_{2} - a_{3}s_{23} - d_{4}c_{23} - d_{6}(c_{23}c_{5} - c_{4}s_{23}s_{5})
\end{aligned}$$

---

## 6) 汇总表

| 变换矩阵 | 涉及关节 | 主要用途 |
|: --------:|:--------:|:---------|
| ${}^{1}T_{3}$ | $\theta_2, \theta_3$ | 前臂运动链 |
| ${}^{4}T_{6}$ | $\theta_5, \theta_6$ | 腕部末端两关节 |
| ${}^{3}T_{6}$ | $\theta_4, \theta_5, \theta_6$ | 完整腕部运动链 |
| ${}^{1}T_{6}$ | $\theta_2 \sim \theta_6$ | 去除基座后的完整链 |
| ${}^{0}T_{6}$ | $\theta_1 \sim \theta_6$ | **最终末端位姿** |

---

## 7) MATLAB 符号验证代码

```matlab
%% DH 完整变换矩阵符号计算
clear; clc;

%% 符号变量定义
syms theta1 theta2 theta3 theta4 theta5 theta6 real
syms a1 a2 a3 d1 d4 d6 real

% 简写
c1 = cos(theta1); s1 = sin(theta1);
c2 = cos(theta2); s2 = sin(theta2);
c3 = cos(theta3); s3 = sin(theta3);
c4 = cos(theta4); s4 = sin(theta4);
c5 = cos(theta5); s5 = sin(theta5);
c6 = cos(theta6); s6 = sin(theta6);

% 复合角
c23 = c2*c3 - s2*s3;  % cos(theta2 + theta3)
s23 = c2*s3 + c3*s2;  % sin(theta2 + theta3)

%% 基本 DH 变换矩阵
T01 = [c1,  0,  s1, a1*c1;
       s1,  0, -c1, a1*s1;
        0,  1,   0,    d1;
        0,  0,   0,     1];

T12 = [c2, -s2, 0, a2*c2;
       s2,  c2, 0, a2*s2;
        0,   0, 1,     0;
        0,   0, 0,     1];

T23 = [c3, 0, -s3, a3*c3;
       s3, 0,  c3, a3*s3;
        0,-1,   0,     0;
        0, 0,   0,     1];

T34 = [c4, 0,  s4,  0;
       s4, 0, -c4,  0;
        0, 1,   0, d4;
        0, 0,   0,  1];

T45 = [c5, 0, -s5, 0;
       s5, 0,  c5, 0;
        0,-1,   0, 0;
        0, 0,   0, 1];

T56 = [c6, -s6, 0,  0;
       s6,  c6, 0,  0;
        0,   0, 1, d6;
        0,   0, 0,  1];

%% 中间变换矩阵计算
T13 = simplify(T12 * T23);
T46 = simplify(T45 * T56);
T36 = simplify(T34 * T45 * T56);
T16 = simplify(T12 * T23 * T34 * T45 * T56);
T06 = simplify(T01 * T16);

%% 显示结果
disp('T13 = '); disp(T13);
disp('T46 = '); disp(T46);
disp('T36 = '); disp(T36);
disp('T16 = '); disp(T16);
disp('T06 = '); disp(T06);

%% 提取 T06 的旋转和平移部分
R06 = T06(1:3, 1:3);
p06 = T06(1:3, 4);

disp('R06 = '); disp(simplify(R06));
disp('p06 = '); disp(simplify(p06));
```

---

## 8) 常用简化形式

### ${}^{1}T_{3}$ 简化形式

$${}^{1}T_{3}=
\begin{bmatrix}
c_{23} & 0 & -s_{23} & a_{2}c_{2}+a_{3}c_{23}\\
s_{23} & 0 & c_{23} & a_{2}s_{2}+a_{3}s_{23}\\
0 & -1 & 0 & 0\\
0 & 0 & 0 & 1
\end{bmatrix}$$

### 腕中心位置（用于逆运动学分离）

腕中心 $p_w$ 可由末端位姿直接计算：

$$p_w = p - d_6 \cdot a$$

其中 $p$ 为末端位置，$a$ 为末端姿态矩阵的第三列（接近向量）。

